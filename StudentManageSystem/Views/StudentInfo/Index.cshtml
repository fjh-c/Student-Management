
@{
    ViewData["Title"] = "学生信息管理";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style type="text/css"> 
    .layui-table-cell{
	    height:auto!important;
	    white-space:normal;
    }
    .layui-table img {
        max-width: 60px;
        max-height: 60px;
    }
</style> 

<div class="layui-card">
    <div class="layui-card-header">
        <div class="layui-form">
            <div class="layui-form-item ">
                <div class="layui-inline"><i class="fa fa-file-text-o fa-fw"></i> @ViewBag.Title</div>
            </div>
            <div class="layui-form-item layui-layout-left">
                <div class="layui-inline">
                    <input class="layui-input layui-input-sm" style="width: 300px;" type="text" name="search" placeholder="快速查找" autocomplete="off">
                </div>
                <div class="layui-inline layui-show-xs-block">
                    <button class="layui-btn layui-btn-sm" lay-submit lay-filter="querysubmit">
                        <i class="layui-icon layui-icon-sm">&#xe615;</i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-card-body">
        <table class="layui-hide" id="test" lay-filter="test"></table>
    </div>
</div>

@section Scripts{
    <script type="text/javascript">
        //监听表单提交事件
        hg.form.onsubmit('querysubmit', function (data) {
            table && table.reload(data);
        });
        var tableCols = [[
            { type: 'checkbox' },
            {
                field: 'id',
                width: 80,
                title: '编号',
                sort: true
            }, {
                field: 'name',
                width: 100,
                title: '学生姓名',
                sort: true
            }, {
                field: 'genderName',
                title: '性别',
                width: 80,
                sort: true
            }, {
                field: 'nationName',
                title: '民族',
                width: 80,
                sort: true
            }, {
                field: 'enrollmentDT',
                title: '入学时间',
                width: 100,
                sort: true
            }, {
                field: 'departName',
                title: '学生部门',
                minWidth: 100,
                sort: true
            }, {
                field: 'phone',
                title: '学生电话',
                width: 120
            }, {
                field: 'email',
                title: '学生邮箱',
                minWidth: 100
            }, {
                field: 'address',
                title: '学生地址',
                minWidth: 100,
                sort: true
            }, {
                field: 'photos',
                title: '学生照片',
                width: 100,
                align: 'center',
                templet: function (d) {
                    return '<img src="' + d.photos  + '" />';
                }
            }, {
                field: 'statusName',
                title: '激活状态',
                width: 100,
                sort: true
            }, {
                field: 'right',
                width: 160,
                title: '操作',
                templet: function (d) {
                    return '<a class="layui-btn layui-btn-xs" lay-event="details">详情</a> <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit">编辑</a> <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>'
                }
            }]
        ];
        //通过行tool详情，lay-event="details"
        function details(obj) {
            if (obj.data.id) {
                hg.open('详情', '/StudentInfo/Details/' + obj.data.id, 600, 420);
            }
        }
        //通过行tool编辑，lay-event="edit"
        function edit(obj) {
            if (obj.data.id) {
                hg.open('修改学生信息', '/StudentInfo/Edit/' + obj.data.id, 600, 420);
            }
        }
        //通过行tool删除，lay-event="del"
        function del(obj) {
            if (obj.data.id) {
                hg.confirm("学生：" + obj.data.name + "，确定要删除吗？", function () {
                    $.ajax({
                        url: '/StudentInfo/Delete',
                        data: {id: obj.data.id},
                        type: 'POST',
                        success: function (data) {
                            if (data.success) {
                                obj.del(); //只删本地数据
                                hg.msghide("删除成功！");
                            }
                            else {
                                hg.msg("删除失败！");
                            }
                        },
                        error: function () {
                            hg.msg("网络请求失败！");
                        }
                    });
                });
            }
        }
        var toolbar = [{
            text: '删除',
            layuiicon: '&#xe640;',
            class: 'layui-btn-danger',
            handler: function (obj, row) {
                if (obj.checkstatus && obj.checkstatus.data.length > 0) {
                    hg.confirm("批量删除所有选中的数据，确定要删除吗？", function () {
                        //console.log(obj.checkstatus.data.map(function (x) { return x.id }).join(','))
                        $.ajax({
                            url: '/StudentInfo/DeleteAll',
                            data: { arr: obj.checkstatus.data.map(function (x) { return x.id }) },
                            type: 'POST',
                            success: function (data) {
                                if (data.success) {
                                    hg.msg('批量删除成功！');
                                    //重载表格数据
                                    //hg.table.datatable('test', 'reload');
                                    table && table.reload();
                                }
                                else {
                                    hg.msg("删除失败！");
                                }
                            },
                            error: function () {
                                hg.msg("网络请求失败！");
                            }
                        });

                    });
                } else {
                    hg.msg('请选中一个或多个复选框，再操作！');
                }
            }
        }, {
            text: '添加',
            layuiicon: '&#xe608;',
            class: 'layui-btn-normal',
            handler: function () {
                hg.open('添加学生', '/StudentInfo/Create', 600, 420);
            }
        }
        ];
        //基本数据表格
        var table = hg.table.datatable('test', '学生信息管理', '/StudentInfo/GetQueryPagedList', {}, tableCols, toolbar, true, 'full-100', ['filter', 'print', 'exports']);

    </script>
}